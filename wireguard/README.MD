# üîê WireGuard - Configura√ß√£o Completa

Este reposit√≥rio cont√©m uma configura√ß√£o completa para servidor e clientes WireGuard, incluindo scripts automatizados para gera√ß√£o de configura√ß√µes e gerenciamento do servi√ßo.

## üìÅ Estrutura do Projeto

```
wireguard/
‚îú‚îÄ‚îÄ README.MD                    # Este arquivo
‚îú‚îÄ‚îÄ client/                     # Configura√ß√µes e ferramentas para clientes
‚îÇ   ‚îú‚îÄ‚îÄ generate-config.sh      # Script para gerar configura√ß√µes de cliente
‚îÇ   ‚îî‚îÄ‚îÄ example/               # Exemplos de configura√ß√£o por plataforma
‚îÇ       ‚îú‚îÄ‚îÄ client-linux.conf   # Configura√ß√£o exemplo para Linux
‚îÇ       ‚îú‚îÄ‚îÄ client-mac.conf     # Configura√ß√£o exemplo para macOS
‚îÇ       ‚îî‚îÄ‚îÄ client-windows.conf # Configura√ß√£o exemplo para Windows
‚îî‚îÄ‚îÄ server/                     # Configura√ß√µes e ferramentas para servidor
    ‚îú‚îÄ‚îÄ restart-wireguard.sh    # Script para reiniciar o servi√ßo WireGuard
    ‚îî‚îÄ‚îÄ example/               # Exemplos de configura√ß√£o do servidor
        ‚îî‚îÄ‚îÄ server.conf         # Configura√ß√£o exemplo do servidor
```

## üñ•Ô∏è Pasta `client/`

A pasta `client` cont√©m todas as ferramentas e configura√ß√µes relacionadas aos clientes WireGuard.

### üìÑ `generate-config.sh`

Script automatizado que gera configura√ß√µes completas para novos clientes WireGuard.

#### ‚ú® Funcionalidades:
- **Gera√ß√£o autom√°tica de chaves**: Cria automaticamente chaves privadas e p√∫blicas para cada cliente
- **Configura√ß√£o personalizada**: Permite definir endere√ßos IP espec√≠ficos para cada cliente
- **Organiza√ß√£o autom√°tica**: Cria pastas organizadas baseadas no IP do cliente
- **Valida√ß√£o**: Verifica formatos de IP e depend√™ncias do sistema
- **Configura√ß√£o via .env**: Utiliza arquivo de ambiente para configura√ß√µes do servidor

#### üöÄ Como usar:

1. **Criar arquivo `.env`** na pasta raiz com as seguintes vari√°veis:
   ```bash
   WG_SERVER_PUBLIC_KEY=sua_chave_publica_do_servidor
   WG_INTERFACE_ADDRESS=10.10.10.1/24
   WG_SERVER_ENDPOINT=seu.servidor.com:51820
   FOLDER_PREFIX=cliente
   ```

2. **Executar o script**:
   ```bash
   cd client/
   chmod +x generate-config.sh
   ./generate-config.sh
   ```

3. **Informar o IP do t√∫nel** quando solicitado (ex: `10.10.10.5/32`)

#### üì§ Sa√≠da do script:
- `cliente-X/wg-client.conf`: Configura√ß√£o completa do cliente
- `cliente-X/privatekey.conf`: Chave privada do cliente
- `cliente-X/publickey.conf`: Chave p√∫blica do cliente (para adicionar no servidor)

### üìÇ `example/`

Cont√©m exemplos de configura√ß√£o para diferentes plataformas:

- **`client-linux.conf`**: Configura√ß√£o otimizada para sistemas Linux
- **`client-mac.conf`**: Configura√ß√£o para macOS
- **`client-windows.conf`**: Configura√ß√£o para Windows

Cada exemplo demonstra:
- Configura√ß√£o da interface do cliente
- Endere√ßamento IP espec√≠fico
- Configura√ß√£o do peer (servidor)
- Keep-alive para manter conex√£o est√°vel

## üñß Pasta `server/`

A pasta `server` cont√©m ferramentas e configura√ß√µes para o servidor WireGuard.

### üîÑ `restart-wireguard.sh`

Script para reiniciar o servi√ßo WireGuard de forma controlada e monitorada.

#### ‚ú® Funcionalidades:
- **Rein√≠cio seguro**: Para e inicia o servi√ßo de forma controlada
- **Logs informativos**: Fornece feedback detalhado sobre o processo
- **Verifica√ß√£o de status**: Confirma se o servi√ßo foi reiniciado com sucesso
- **Configura√ß√£o via .env**: Permite personalizar a interface WireGuard

#### üöÄ Como usar:

1. **Configurar arquivo `.env`** (opcional):
   ```bash
   WG_INTERFACE=wg0
   ```

2. **Executar o script**:
   ```bash
   cd server/
   chmod +x restart-wireguard.sh
   ./restart-wireguard.sh
   ```

#### üìä O script mostra:
- Status atual do servi√ßo
- Processo de parada e inicializa√ß√£o
- Confirma√ß√£o de sucesso
- Logs detalhados em caso de erro

### üìÇ `example/`

- **`server.conf`**: Exemplo completo de configura√ß√£o do servidor WireGuard

#### Caracter√≠sticas da configura√ß√£o do servidor:
- **Interface do servidor**: `10.10.10.1/24`
- **Porta de escuta**: `51820`
- **M√∫ltiplos peers**: Suporte para Linux, Windows e macOS
- **Organiza√ß√£o clara**: Coment√°rios explicativos para cada se√ß√£o

## ‚öôÔ∏è Configura√ß√£o Inicial

### 1. Preparar o Ambiente

```bash
# Instalar WireGuard (Ubuntu/Debian)
sudo apt update
sudo apt install wireguard

# Ou no CentOS/RHEL
sudo yum install epel-release
sudo yum install wireguard-tools
```

### 2. Configurar Servidor

1. Copiar `server/example/server.conf` para `/etc/wireguard/wg0.conf`
2. Gerar chaves do servidor:
   ```bash
   wg genkey | tee server_private.key | wg pubkey > server_public.key
   ```
3. Editar configura√ß√£o substituindo as chaves
4. Iniciar o servi√ßo:
   ```bash
   sudo systemctl enable wg-quick@wg0
   sudo systemctl start wg-quick@wg0
   ```

### 3. Gerar Clientes

1. Criar arquivo `.env` na raiz do projeto
2. Usar o script `client/generate-config.sh` para cada novo cliente
3. Adicionar a chave p√∫blica do cliente na configura√ß√£o do servidor
4. Reiniciar o servidor usando `server/restart-wireguard.sh`

## üîß Exemplo de Fluxo Completo

```bash
# 1. Gerar configura√ß√£o para novo cliente
cd client/
./generate-config.sh
# IP informado: 10.10.10.5/32

# 2. Adicionar cliente no servidor
sudo nano /etc/wireguard/wg0.conf
# Adicionar se√ß√£o [Peer] com a chave p√∫blica gerada

# 3. Reiniciar servidor
cd ../server/
sudo ./restart-wireguard.sh

# 4. Enviar arquivo cliente-5/wg-client.conf para o cliente
```

## üìã Vari√°veis de Ambiente (.env)

```bash
# Chave p√∫blica do servidor WireGuard
WG_SERVER_PUBLIC_KEY=ChavePublicaDoServidor=

# Endere√ßo da interface/rede do t√∫nel
WG_INTERFACE_ADDRESS=10.10.10.0/24

# Endpoint do servidor (IP:Porta)
WG_SERVER_ENDPOINT=meu.servidor.com:51820

# Prefixo para pastas dos clientes
FOLDER_PREFIX=cliente

# Interface WireGuard (opcional, padr√£o: wg0)
WG_INTERFACE=wg0
```

## üõ°Ô∏è Seguran√ßa

- **Chaves √∫nicas**: Cada cliente possui chaves criptogr√°ficas √∫nicas
- **IPs isolados**: Cada cliente tem seu pr√≥prio endere√ßo IP no t√∫nel
- **Keep-alive**: Mant√©m conex√µes est√°veis atrav√©s de NAT/Firewall
- **Valida√ß√£o**: Scripts validam formatos e depend√™ncias

## üêõ Solu√ß√£o de Problemas

### Cliente n√£o conecta
1. Verificar se as chaves est√£o corretas
2. Confirmar se o cliente foi adicionado na configura√ß√£o do servidor
3. Reiniciar o servi√ßo do servidor

### Servidor n√£o inicia
1. Verificar configura√ß√£o em `/etc/wireguard/wg0.conf`
2. Confirmar se a porta est√° dispon√≠vel: `sudo netstat -tulpn | grep 51820`
3. Verificar logs: `sudo journalctl -u wg-quick@wg0`

---

üìö **Documenta√ß√£o oficial**: [WireGuard](https://www.wireguard.com/)